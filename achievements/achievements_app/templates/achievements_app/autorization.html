<!DOCTYPE html>
<html>
<head>
    <title>Achievements</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'achievements_app/css/autorization.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
</head>
<body>
    <div class="header"></div>
    <div class="title">Вход</div>
    <div class="minititle">Введите логин</div>
    <div class="minititle2">Введите пароль</div>
    <div class="eror">*ошибка</div>
    <div class="eror2">*ошибка</div>
    <a href="{% url 'recovery' %}?login=" class="forgotPassword">забыли пароль?</a>

    <div class="button"></div>
    <div class="buttonText">Вход</div>
    <div class="containerLogin container-toggle">
        <input type="text" class="input-field" maxlength="30" placeholder="Логин">
    </div>
    <div class="containerPassword container-toggle">
        <input type="password" class="input-field" maxlength="30" placeholder="Пароль">
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const button = document.querySelector('.button');
            const forgotPassword = document.querySelector('.forgotPassword');

            const loginInput = document.querySelector('.containerLogin input');
            const passwordInput = document.querySelector('.containerPassword input');
            const error1 = document.querySelector('.eror');
            const error2 = document.querySelector('.eror2');
            forgotPassword.addEventListener('click', function() {

                error1.classList.remove('show-error');
                error2.classList.remove('show-error');
                const login = loginInput.value.trim();

                if (!login) {
                    error1.textContent = '*Введите логин';
                    error1.classList.add('show-error');
                    return;
                }

                sessionStorage.setItem('recovery_login', login);
                window.location.href = `{% url 'recovery' %}?login=${encodeURIComponent(login)}`;
            });
            button.addEventListener('click', function() {
                error1.classList.remove('show-error');
                error2.classList.remove('show-error');

                let hasError = false;

                if (!loginInput.value.trim()) {
                    error1.textContent = '*обязательно';
                    error1.classList.add('show-error');
                    hasError = true;
                }

                if (!passwordInput.value.trim()) {
                    error2.textContent = '*обязательно';
                    error2.classList.add('show-error');
                    hasError = true;
                }
                if (hasError) return;
                fetch('{% url "check_user" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({
                        login: loginInput.value.trim(),
                        password: passwordInput.value.trim()
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.exists) {
                        window.location.href = '{% url "recovery" %}';
                    } else {
                        error2.textContent = '*неверный логин или пароль';
                        error2.classList.add('show-error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        });
    </script>
</body>
</html>
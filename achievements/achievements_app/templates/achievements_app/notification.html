<!DOCTYPE html>
<html>
<head>
    <title>Achievements</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'achievements_app/css/notification.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
</head>
<body>
<div class="backgroundProfile"></div>
<div class="backgroundProfile"></div>
<label class="toggle-container">
  <input type="checkbox" class="toggle-input">
  <div class="toggle-background"></div>
  <div class="toggle-switch"></div>
</label>
<div class="titleNotification">Уведомления</div>
<script>

    document.addEventListener('DOMContentLoaded', function() {
        let checkSwitch = false;
        const backgroundSwitch = document.querySelector('.toggle-background');
        const switchPart = document.querySelector('.toggle-switch');

        async function switching() {
            if (checkSwitch == true) {


                try
                {
                    const response = await fetch('{% url "editActiveNotification" %}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({
                            phone: localStorage.getItem('numberPhone'),
                            isActiveNotification: !checkSwitch
                        })
                    });

                    const data = await response.json();
                    if (!data.success) {
                        updateSwitchUI(checkSwitch);
                        console.error('Ошибка обновления:', data.error);
                    }
                    else
                    {
                        updateSwitchUI(checkSwitch);
                        checkSwitch = false;
                    }
                }
                catch (error)
                {
                    checkSwitch = true;
                    updateSwitchUI(checkSwitch);
                }
            }
           else if (checkSwitch == false)
           {

                try
                {
                    const response = await fetch('{% url "editActiveNotification" %}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({
                            phone: localStorage.getItem('numberPhone'),
                            isActiveNotification: !checkSwitch
                        })
                    });

                    const data = await response.json();
                    if (!data.success) {

                        console.error('Ошибка обновления:', data.error);
                    }
                    else
                    {
                        updateSwitchUI(checkSwitch);
                        checkSwitch = true;
                    }
                }
                catch (error)
                {
                    checkSwitch = false;
                    updateSwitchUI(checkSwitch);
                }
           }
           console.log(checkSwitch);
        }
        backgroundSwitch.addEventListener('click', switching);
        switchPart.addEventListener('click', switching);
        fetch('{% url "check_isActiveNotification" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                phone: localStorage.getItem('numberPhone')
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.notification == true)
            {
                updateSwitchUI(checkSwitch);
                checkSwitch = true;
            }
            if (data.notification == false)
            {
                 checkSwitch = false;
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
        function updateSwitchUI(isActive) {

            if (!isActive) {
                switchPart.style.transform = 'translateX(30px)';
                backgroundSwitch.style.background = '#878CCD';

            } else {
                switchPart.style.transform = 'translateX(0)';
                backgroundSwitch.style.background = '#CEDDE6';
            }
        }
    });


</script>
</body>
</html>